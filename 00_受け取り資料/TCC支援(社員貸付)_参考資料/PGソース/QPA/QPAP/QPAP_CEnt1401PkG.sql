CREATE OR REPLACE PACKAGE QPAP_Cent1401PkG IS
/*****************************************************************************/
/* ÉVÉXÉeÉÄñº    ÅFçÇìáâÆÉNÉåÉWÉbÉgÉVÉXÉeÉÄ                                  */
/* ã∆ñ±ñº        ÅFé–àıóZéëä«óù                                              */
/* ÉÇÉWÉÖÅ[Éãñº  ÅFQPAP_Cent1401PkG                                          */
/* ã@î\          ÅFçTèúòAóçï\àÛç¸                                            */
/*                 QPAP_Cent140PkG Ç™ëÂÇ´Ç≠Ç»ÇËÇ∑Ç¨ÇΩÇΩÇﬂÅAàÍïîä÷êîÇÇ±ÇÃíÜ  */
/*                 Ç≈èàóùÇ∑ÇÈ                                                */
/* çÏê¨ì˙        ÅF2006/02/XX                                                */
/* çÏê¨é“        ÅFFIP                                                       */
/* èCê≥óöó  àƒåèî‘çÜ  ì˙ït  èCê≥é“       îıçl                               */
/* 00001    0811051 2009/08/28 NBC ISHIDA äÆçœì˙Ç™ì¸óÕÇ≥ÇÍÇƒÇ¢ÇÈÉfÅ[É^ÇÕ     */
/*                                        ëSÇƒçTèúÉfÅ[É^Ç™Ç≥ÇÍÇ»Ç¢à◊ÅA       */
/*                                        äÆçœì˙Ç…ÇÊÇËçTèúÉfÅ[É^Ç           */
/*                                        çÏê¨Ç∑ÇÈèåèÇí«â¡                 */
/* 00002    0811051 2009/08/28 NBC ISHIDA çTèúÉfÅ[É^çÏê¨éûÇÃçTèúíÜé~ÉtÉâÉOÇ */
/*                                        çTèúòAóçï\Ç…îΩâfÇ≥ÇπÇÈ             */
/*****************************************************************************/

/*****************************************************************************/
/*                ÇP  êÈåæïî                                                 */
/*****************************************************************************/
/* è‹ó^ì˙éÊìæä÷êî                  */
FUNCTION QPAP_CEnt1401GetBONUSDayFnc(
	InStrYMD  IN CHAR,
	BONUSYMD  IN CHAR
) RETURN CHAR;

/* çTèúòAóçï\_è‹ó^óòëßåvéZ ä÷êî (Return óòëß) */
FUNCTION QPAP_CEnt1401SyoRisokuFnc (
	InYUSIYMD         IN  QPA8_SYNDAICYOT.QPA8_PRMYUSIYMD%TYPE,     --óZéëì˙
	InSYOYOHENSAIALL  IN  QPA8_SYNDAICYOT.QPA8_SYOYOHENSAIALL%TYPE, --è‹ó^ï‘çœëçäz
	InSYOYOHENSAI     IN  QPA8_SYNDAICYOT.QPA8_SYOYOHENSAI%TYPE,    --è‹ó^ï‘çœäz
	InSYOYOZANDAKA    IN  QPA8_SYNDAICYOT.QPA8_SYOYOZANDAKA%TYPE,   --è‹ó^écçÇ
	InRIRITU          IN  QPA8_SYNDAICYOT.QPA8_RIRITU%TYPE,         --å_ñÒóòó¶
	InBONUSYMD1       IN  VARCHAR2,                                 --è‹ó^éxããì˙ÇP
	InBONUSYMD2       IN  VARCHAR2,                                 --è‹ó^éxããì˙ÇQ
	InStrYMD          IN  VARCHAR2                                  --è‹ó^ì˙ït
) RETURN  QPAA_KOJOT.QPAA_RISOKU%TYPE;

/* çTèúòAóçï\_è‹ó^óòëßÇvÇnÇqÇjçÏê¨ */
PROCEDURE QPAP_CEnt1401SyouyoRisoku (
	InStrUserID     IN  VARCHAR2,                                   --ÉÜÅ[ÉUÅ[ÇhÇc
	InStrComputerNM IN  VARCHAR2,                                   --ÉRÉìÉsÉÖÅ[É^ñº
	InStrYMD        IN  VARCHAR2,                                   --è‹ó^ì˙ït
	IngblSyousyoYMD IN  VARCHAR2
);

/* çTèúòAóçï\_è‹ó^àÛç¸ÇvÇnÇqÇjçÏê¨ */
PROCEDURE QPAP_CEnt1401KojoPrtSyouyo2 (
	InStrUserID     IN  VARCHAR2,                                   --ÉÜÅ[ÉUÅ[ÇhÇc
	InStrComputerNM IN  VARCHAR2,                                   --ÉRÉìÉsÉÖÅ[É^ñº
	InStrYMD        IN  VARCHAR2                                    --è‹ó^ì˙ït
);

/* ADD 00001 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA START */
/* çTèúíÜé~îªíËèàóù */
FUNCTION QPAP_CEnt1401KojocyushiChek (
	InSyainCD1          IN  VARCHAR2,                               --é–àıÉRÅ[ÉhÇP
	InSyainCD2          IN  VARCHAR2,                               --é–àıÉRÅ[ÉhÇQ
	InStrYMDHMS         IN  VARCHAR2                                --çTèúì˙
) RETURN CHAR;
/* ADD 00001 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA END */

END QPAP_CEnt1401PkG;
/
SHOW ERRORS;

CREATE OR REPLACE PACKAGE BODY QPAP_CEnt1401PkG IS
/*****************************************************************************/
/*                ÇQ  É{ÉfÉBÅ[                                               */
/*****************************************************************************/
	/* ÉVÉXÉeÉÄïœçXé¿é{ì˙ */
	/*ÅiÇ±ÇÃì˙à»ç~ÇÃóZéëì˙ÇÃë›ïtÇÕêVåvéZéÆÇ≈ÅAÇ±ÇÃì˙ÇÊÇËëOÇÃóZéëì˙ÇÃë›ïtÇÕãååvéZéÆÇ≈ÅAóòëßÇåvéZÇ∑ÇÈÅj*/
	gbl_SysChangeYMD    CHAR(08) := '20000301';    --ÉVÉXÉeÉÄïœçXé¿é{ì˙
	gbl_SysChangeYMD2   CHAR(08) := '20011101';    --ÉVÉXÉeÉÄïœçXé¿é{ì˙

	gbl_ZenRiritu       NUMBER;      --ëOåéóòó¶
	gbl_ZenZenRiritu    NUMBER;      --ëOÅXåéóòó¶
	gbl_ZenRiritu2      NUMBER;      --ëOåéóòó¶
	gbl_ZenZenRiritu2   NUMBER;      --ëOÅXåéóòó¶
	InStrYMD_2          CHAR(08);
	v_FROMDATE          CHAR(08);
	v_TODATE            CHAR(08);
	v_TODATE_2          CHAR(08);
	v_BONUSMM1          CHAR(02);
	v_BONUSMM2          CHAR(02);
	v_SYOYOMM           CHAR(02);
	StrSQL              VARCHAR2(1000);

/****************************************************************************************/
/* ÉÇÉWÉÖÅ[Éãñº  ÅFQPAP_CEnt1401GetBONUSDayFnc                                           */
/* ã@î\          ÅF12åé26ì˙Å`31ì˙ÇÃè‹ó^ì˙Ç…ëŒÇµÇƒÅAîNìxÇÇ‡Ç«Ç∑ÇÊÇ§Ç…Ç∑ÇÈÅB             */
/* InStrYMD      ÅFçTèúé¿çsì˙(yyyymmdd)                                                 */
/* BONUSYMD      ÅFè‹ó^ì˙(mmdd)                                                         */
/****************************************************************************************/
FUNCTION QPAP_CEnt1401GetBONUSDayFnc(
	InStrYMD  IN CHAR,
	BONUSYMD  IN CHAR) RETURN CHAR IS
	rBONUSYMD CHAR(8);
BEGIN
	IF  SUBSTR(InStrYMD,5,2) = '01'
	AND TO_NUMBER(BONUSYMD) >= 1226 AND TO_NUMBER(BONUSYMD) <= 1231 THEN
		rBONUSYMD := TO_CHAR(TO_NUMBER(SUBSTR(InStrYMD,1,4)) -1) || BONUSYMD;
	ELSE
		rBONUSYMD := SUBSTR(InStrYMD,1,4) || BONUSYMD;
	END IF;
	RETURN rBONUSYMD;
END QPAP_CEnt1401GetBONUSDayFnc;

/*****************************************************************************/
/* ÉÇÉWÉÖÅ[Éãñº  ÅFQPAP_CEnt1401SyoRisokuFnc                                 */
/* ã@î\          ÅFçTèúòAóçï\_è‹ó^óòëßåvéZ ä÷êî (Return óòëß)                */
/*                 Ç±Ç±ÇÃèàóùÇÕÅAQPAP_CEnt140SyoRisokuFnc ÇÃÇŸÇ⁄å¥å^ÇÃÇ‹Ç‹Ç… */
/*                 ÇµÇƒÇ®Ç≠                                                  */
/*****************************************************************************/
FUNCTION QPAP_CEnt1401SyoRisokuFnc (
	InYUSIYMD         IN QPA8_SYNDAICYOT.QPA8_PRMYUSIYMD%TYPE,     --óZéëì˙
	InSYOYOHENSAIALL  IN QPA8_SYNDAICYOT.QPA8_SYOYOHENSAIALL%TYPE, --è‹ó^ï‘çœëçäz
	InSYOYOHENSAI     IN QPA8_SYNDAICYOT.QPA8_SYOYOHENSAI%TYPE,    --è‹ó^ï‘çœäz
	InSYOYOZANDAKA    IN QPA8_SYNDAICYOT.QPA8_SYOYOZANDAKA%TYPE,   --è‹ó^écçÇ
	InRIRITU          IN QPA8_SYNDAICYOT.QPA8_RIRITU%TYPE,         --å_ñÒóòó¶
	InBONUSYMD1       IN VARCHAR2,                                 --è‹ó^éxããì˙ÇP
	InBONUSYMD2       IN VARCHAR2,                                 --è‹ó^éxããì˙ÇQ
	InStrYMD          IN VARCHAR2)                                 --è‹ó^ì˙ït
RETURN QPAA_KOJOT.QPAA_RISOKU%TYPE IS
	v_YUSIDD   CHAR(02);
	v_YMD_W1   CHAR(08);    --çÏã∆óp îNåéì˙
	v_YMD_W2   CHAR(08);    --çÏã∆óp îNåéì˙
	v_Kikan    NUMBER;      --è‹ó^ï‘çœä˙ä‘
	v_Risoku   NUMBER;      --óòëß
	v_Nisuu    NUMBER;      --ì˙êî
	v_RIRITU   NUMBER;      --óòó¶
BEGIN
	--èâä˙âªèàóù
	v_Risoku   := 0;
	v_RIRITU   := TRUNC(InRIRITU / 36500 * 1000000) / 1000000;
	v_SYOYOMM  := SUBSTR(InStrYMD,    5, 2);
	v_BONUSMM1 := SUBSTR(InBONUSYMD1, 5, 2);
	v_BONUSMM2 := SUBSTR(InBONUSYMD2, 5, 2);
	v_Kikan    := MONTHS_BETWEEN(TO_DATE(SUBSTR(InBONUSYMD2, 1, 6), 'YYYYMM'), TO_DATE(SUBSTR(InBONUSYMD1, 1, 6), 'YYYYMM')); --è‹ó^ï‘çœä˙ä‘

	/**********************************************/
	/* óZéëì˙Ç™ 2000/03/01 Çã´Ç…åvéZéÆÇï™ÇØÇÈ   */
	/**********************************************/
	If TO_CHAR(InYUSIYMD,'YYYYMMDD') < gbl_SysChangeYMD Then
		/***************/
		/* ãååvéZéÆ    */
		/***************/
		If v_Kikan = 6 Then
			If InSYOYOZANDAKA = InSYOYOHENSAIALL Then
			/*--If MySet!è‹ó^écçÇ = MySet!è‹ó^ï‘çœäzëçäz Then          'èââÒóòëßÇÃîªíË */
				If v_BONUSMM1 = v_SYOYOMM Then
					/*--If Month(CVDate(è‹ó^éxããîNåéì˙1)) = Month(èàóùëŒè€ì˙ït) Then */
					-- å≥ÅXÇÃåvéZéÆ
					If SUBSTR(TO_CHAR(TO_Date(InBONUSYMD1,'YYYYMMDD') + 1,'YYYYMMDD'),5,2) <> SUBSTR(TO_CHAR(TO_Date(InBONUSYMD1,'YYYYMMDD'),'YYYYMMDD'),5,2) Then
						/*--If Month(DateAdd("y", 1, CVDate(è‹ó^éxããîNåéì˙1))) <> Month(CVDate(è‹ó^éxããîNåéì˙1)) Then */
						v_Nisuu  := MONTHS_BETWEEN(TO_DATE(SUBSTR(InStrYMD,1,6),'YYYYMM'),TO_DATE(TO_CHAR(InYUSIYMD,'YYYYMM'),'YYYYMM')) * 30;
						v_YUSIDD   := SUBSTR(TO_CHAR(InYUSIYMD,'YYYYMMDD'),7,2);
						IF v_YUSIDD >= '11' THEN
							v_Nisuu := v_Nisuu + 6;
						ELSE
							v_Nisuu := v_Nisuu + 21;
						END IF;
					Else
						v_Nisuu  := MONTHS_BETWEEN(TO_DATE(SUBSTR(InStrYMD,1,6),'YYYYMM'),TO_DATE(TO_CHAR(InYUSIYMD,'YYYYMM'),'YYYYMM')) * 30;
						v_YUSIDD   := SUBSTR(TO_CHAR(InYUSIYMD,'YYYYMMDD'),7,2);
						IF v_YUSIDD >= '11' THEN
							v_Nisuu := v_Nisuu + 6;
						ELSE
							v_Nisuu := v_Nisuu + 21;
						END IF;
						v_Nisuu := v_Nisuu + (TO_NUMBER(SUBSTR(InBONUSYMD1,7,2)) - 1 - 30);
					End If;
					v_Risoku := TRUNC(InSYOYOHENSAIALL * InRIRITU * v_Nisuu / 2 / 18000);
					/*--v_Risoku = Int(MySet!è‹ó^ï‘çœäzëçäz * MySet!å_ñÒóòó¶ * ì˙êî_WORK / 2 / 18000) */
				Else
					If SUBSTR(TO_CHAR(TO_Date(InBONUSYMD2,'YYYYMMDD') + 1,'YYYYMMDD'),5,2) <> SUBSTR(TO_CHAR(TO_Date(InBONUSYMD2,'YYYYMMDD'),'YYYYMMDD'),5,2) Then
						v_Nisuu  := MONTHS_BETWEEN(TO_DATE(SUBSTR(InStrYMD,1,6),'YYYYMM'),TO_DATE(TO_CHAR(InYUSIYMD,'YYYYMM'),'YYYYMM')) * 30;
						v_YUSIDD   := SUBSTR(TO_CHAR(InYUSIYMD,'YYYYMMDD'),7,2);
						IF v_YUSIDD >= '11' THEN
							v_Nisuu := v_Nisuu + 6;
						ELSE
							v_Nisuu := v_Nisuu + 21;
						END IF;
					ELSE
						v_Nisuu  := MONTHS_BETWEEN(TO_DATE(SUBSTR(InStrYMD,1,6),'YYYYMM'),TO_DATE(TO_CHAR(InYUSIYMD,'YYYYMM'),'YYYYMM')) * 30;
						v_YUSIDD := SUBSTR(TO_CHAR(InYUSIYMD,'YYYYMMDD'),7,2);
						IF v_YUSIDD >= '11' THEN
							v_Nisuu := v_Nisuu + 6;
						ELSE
							v_Nisuu := v_Nisuu + 21;
						END IF;
						v_Nisuu := v_Nisuu + (TO_NUMBER(SUBSTR(InBONUSYMD2,7,2)) - 1 - 30);
					END If;
					v_Risoku := TRUNC(InSYOYOHENSAIALL * InRIRITU * v_Nisuu / 2 / 18000);
				END IF;
			Else
				v_Risoku := TRUNC(InSYOYOZANDAKA * InRIRITU / 200);
				/*--v_Risoku = Int(MySet!è‹ó^écçÇ * MySet!å_ñÒóòó¶ / 200) */
			End If;
		Else
			If InSYOYOZANDAKA = InSYOYOHENSAIALL Then
				/*--If MySet!è‹ó^écçÇ = MySet!è‹ó^ï‘çœäzëçäz Then          'èââÒóòëßÇÃîªíË */
				v_Nisuu  := MONTHS_BETWEEN(TO_DATE(SUBSTR(InStrYMD,1,6),'YYYYMM'),TO_DATE(TO_CHAR(InYUSIYMD,'YYYYMM'),'YYYYMM')) * 30;
				v_YUSIDD   := SUBSTR(TO_CHAR(InYUSIYMD,'YYYYMMDD'),7,2);
				IF v_YUSIDD >= '11' THEN
					v_Nisuu := v_Nisuu + 6;
				ELSE
					v_Nisuu := v_Nisuu + 21;
				END IF;
				v_Nisuu := v_Nisuu + ((10) - 1 - 30);
				v_Risoku := TRUNC(InSYOYOHENSAIALL * InRIRITU * v_Nisuu / 2 / 18000);
				/*--v_Risoku = Int(MySet!è‹ó^ï‘çœäzëçäz * MySet!å_ñÒóòó¶ * ì˙êî_WORK / 2 / 18000) */
			Else
				If v_BONUSMM1 = v_SYOYOMM Then
					/* --If Month(CVDate(è‹ó^éxããîNåéì˙1)) = Month(èàóùëŒè€ì˙ït) Then */
					v_YMD_W1 := SUBSTR(TO_CHAR(ADD_MONTHS(TO_DATE(InStrYMD,'YYYYMMDD'),-12),'YYYYMMDD'),1,4) || SUBSTR(InBONUSYMD2,5,4);
					v_YMD_W2 := SUBSTR(InStrYMD,1,4) || SUBSTR(InBONUSYMD1,5,4);
					v_Risoku := TRUNC(InSYOYOZANDAKA * InRIRITU * MONTHS_BETWEEN(TO_DATE(SUBSTR(v_YMD_W2,1,6),'YYYYMM'), TO_DATE(SUBSTR(v_YMD_W1,1,6),'YYYYMM')) / 12 / 100);
				Else
					v_YMD_W1 := SUBSTR(InStrYMD,1,4) || SUBSTR(InBONUSYMD2,5,4);
					v_YMD_W2 := SUBSTR(InStrYMD,1,4) || SUBSTR(InBONUSYMD1,5,4);
					v_Risoku := TRUNC(InSYOYOZANDAKA * InRIRITU * MONTHS_BETWEEN(TO_DATE(SUBSTR(v_YMD_W1,1,6),'YYYYMM'), TO_DATE(SUBSTR(v_YMD_W2,1,6),'YYYYMM')) / 12 / 100);
				End If;
			End If;
		End If;
	Else
		/*******************/
		/* êVåvéZéÆ        */
		/*******************/
		-- èââÒÇÃîªíË
		If InSYOYOZANDAKA = InSYOYOHENSAIALL Then
		/*--If MySet!è‹ó^écçÇ = MySet!è‹ó^ï‘çœäzëçäz Then */
			-- èââÒÇÃèÍçáÅAóZéëì˙ÅiåvéZÇ∑ÇÈéûÇÕÅ|ÇPì˙ÅjÇ©ÇÁÅAç°âÒÇÃè‹ó^ì˙Ç‹Ç≈ÇÃì˙êî
			If v_BONUSMM1 = v_SYOYOMM Then
			/*--If Month(CVDate(è‹ó^éxããîNåéì˙1)) = Month(èàóùëŒè€ì˙ït) Then */
				v_YMD_W1 := SUBSTR(InStrYMD,1,6) || SUBSTR(InBONUSYMD1,7,2);
				v_Nisuu  := TO_DATE(v_YMD_W1,'YYYYMMDD') - (InYUSIYMD - 1);
			Else
				v_YMD_W1 := SUBSTR(InStrYMD,1,6) || SUBSTR(InBONUSYMD2,7,2);
				v_Nisuu  := TO_DATE(v_YMD_W1,'YYYYMMDD') - (InYUSIYMD - 1);
			End If;
		Else
			-- ÇQâÒñ⁄à»ç~ÇÃèÍçáÅAëOâÒÇÃè‹ó^ì˙Ç©ÇÁÅAç°âÒÇÃè‹ó^ì˙Ç‹Ç≈ÇÃì˙êî
			If v_BONUSMM1 = v_SYOYOMM Then
			/*--If Month(CVDate(è‹ó^éxããîNåéì˙1)) = Month(èàóùëŒè€ì˙ït) Then */
				-- è‹ó^éxããåéÇPÇ™ç°âÒÇÃè‹ó^åéÇÃèÍçá
				If TO_NUMBER(v_BONUSMM1) <  TO_NUMBER(v_BONUSMM2) Then
					/*--If Val(Month(CVDate(è‹ó^éxããîNåéì˙1))) < Val(Month(CVDate(è‹ó^éxããîNåéì˙2))) Then */
					-- ëOâÒÇÃè‹ó^ì˙
					v_YMD_W1 := TO_CHAR(TO_NUMBER(SUBSTR(InStrYMD,1,4)) - 1) || SUBSTR(InBONUSYMD2,5,4);
				Else
					-- ëOâÒÇÃè‹ó^ì˙
					v_YMD_W1 := SUBSTR(InStrYMD,1,4) || SUBSTR(InBONUSYMD2,5,4);
				End If;
				-- ç°âÒÇÃè‹ó^ì˙
				v_YMD_W2 := SUBSTR(InStrYMD,1,4) || SUBSTR(InBONUSYMD1,5,4);
			Else
				-- è‹ó^éxããåéÇQÇ™ç°âÒÇÃè‹ó^åéÇÃèÍçá
				If TO_NUMBER(v_BONUSMM2) <  TO_NUMBER(v_BONUSMM1) Then
					/*--If Val(Month(CVDate(è‹ó^éxããîNåéì˙2))) < Val(Month(CVDate(è‹ó^éxããîNåéì˙1))) Then */
					-- ëOâÒÇÃè‹ó^ì˙
					v_YMD_W1 := TO_CHAR(TO_NUMBER(SUBSTR(InStrYMD,1,4)) - 1) || SUBSTR(InBONUSYMD1,5,4);
				Else
					-- ëOâÒÇÃè‹ó^ì˙
					v_YMD_W1 := SUBSTR(InStrYMD,1,4) || SUBSTR(InBONUSYMD1,5,4);
				End If;
				-- ç°âÒÇÃè‹ó^ì˙
				v_YMD_W2 := SUBSTR(InStrYMD,1,4) || SUBSTR(InBONUSYMD2,5,4);
			End If;
			-- ì˙êîåvéZ
			v_Nisuu  :=  TO_DATE(v_YMD_W2,'YYYYMMDD') - TO_DATE(v_YMD_W1,'YYYYMMDD');
			/*--WORK_ì˙êî = DateDiff("y", CVDate(WORK_DATE1), CVDate(WORK_DATE2)) */
		End If;
		/*******************/
		/* è‹ó^ÇÃóòëßåvéZ  */
		/*******************/
		IF TO_CHAR(InYUSIYMD,'YYYYMMDD')  < gbl_SysChangeYMD2 THEN
			v_Risoku := TRUNC(InSYOYOZANDAKA * InRIRITU * v_Nisuu  / 36500);
		ELSE
			v_Risoku := TRUNC(InSYOYOZANDAKA * v_RIRITU * v_Nisuu);
		END IF;
	End If;

	RETURN v_Risoku;
END QPAP_CEnt1401SyoRisokuFnc;


/*****************************************************************************/
/* ÉÇÉWÉÖÅ[Éãñº  ÅFQPAP_CEnt1401SyouyoRisoku                                 */
/* ã@î\          ÅFçTèúòAóçï\_è‹ó^óòëßÇvÇnÇqÇjçÏê¨                           */
/*****************************************************************************/
PROCEDURE QPAP_CEnt1401SyouyoRisoku (
	InStrUserID     IN  VARCHAR2,                     --ÉÜÅ[ÉUÅ[ÇhÇc
	InStrComputerNM IN  VARCHAR2,                     --ÉRÉìÉsÉÖÅ[É^ñº
	InStrYMD        IN  VARCHAR2,                     --è‹ó^ì˙ït
	IngblSyousyoYMD IN  VARCHAR2
) IS

	/* èàóùå≈óLÇÃïœêî */
	v_CursorID        NUMBER := 0;
	v_CursorID2       NUMBER := 0;
	v_Risoku          NUMBER;     --óòëß
	cnt_KGCHENSAIT    NUMBER;
	v_Dummy           INTEGER;
	v_SelectFlg       INTEGER;
	v_ZenYMD          CHAR(8);    --ëOåé
	v_BONUSYMD18      CHAR(8);
	v_BONUSYMD28      CHAR(8);
	v_BONUSYMD_W      CHAR(8);
	v_YMD             CHAR(8);    --è¨å˚è‹ó^ï‘çœì˙éÊìæópì˙ït
	v_KEIYAKUYMD      QPA1_KGCDAICYOT.QPA1_KEIYAKUYMD%TYPE;
	v_PRMSYAINCD1     QPA8_SYNDAICYOT.QPA8_PRMSYAINCD1%TYPE;
	v_PRMSYAINCD2     QPA8_SYNDAICYOT.QPA8_PRMSYAINCD2%TYPE;
	v_PRMYUSIYMD      QPA8_SYNDAICYOT.QPA8_PRMYUSIYMD%TYPE;
	v_GENDOGAKU       QPA8_SYNDAICYOT.QPA8_GENDOGAKU%TYPE;
	v_SYUBETU         QPA8_SYNDAICYOT.QPA8_SYUBETU%TYPE;
	v_RIRITU          QPA8_SYNDAICYOT.QPA8_RIRITU%TYPE;
	v_HENSAITUKISU    QPA8_SYNDAICYOT.QPA8_HENSAITUKISU%TYPE;
	v_KYUYOHENSAIALL  QPA8_SYNDAICYOT.QPA8_KYUYOHENSAIALL%TYPE;
	v_KYUYOHENSAI     QPA8_SYNDAICYOT.QPA8_KYUYOHENSAI%TYPE;
	v_SYOYOHENSAIALL  QPA8_SYNDAICYOT.QPA8_SYOYOHENSAIALL%TYPE;
	v_SYOYOHENSAI     QPA8_SYNDAICYOT.QPA8_SYOYOHENSAI%TYPE;
	v_KYUYOZANDAKA    QPA8_SYNDAICYOT.QPA8_KYUYOZANDAKA%TYPE;
	v_SYOYOZANDAKA    QPA8_SYNDAICYOT.QPA8_SYOYOZANDAKA%TYPE;
	v_KOJOCYUSIFLG    QPA8_SYNDAICYOT.QPA8_KOJOCYUSIFLG%TYPE;
	v_KANSAIYMD       QPA8_SYNDAICYOT.QPA8_KANSAIYMD%TYPE;
	v_KYUYOZANDAKA_W  QPA8_SYNDAICYOT.QPA8_KYUYOZANDAKA%TYPE;
	v_ZANDAKA         QPAA_KOJOT.QPAA_ZANDAKA%TYPE;     --çTèúÉeÅ[ÉuÉã écçÇ
	v_SIMEIKANJI      QPAC_SYAINM.QPAC_SIMEIKANJI%TYPE;
	v_MISECD          QPAC_SYAINM.QPAC_MISECD%TYPE;
	v_TOZAIKBN        QPAC_SYAINM.QPAC_TOZAIKBN%TYPE;
	v_BUMONCD         QPAC_SYAINM.QPAC_BUMONCD%TYPE;
	v_TAISYOKUYMD     QPAC_SYAINM.QPAC_TAISYOKUYMD%TYPE;
	v_KYUSYOSTYMD     QPAC_SYAINM.QPAC_KYUSYOSTYMD%TYPE;
	v_KYUSYOEDYMD     QPAC_SYAINM.QPAC_KYUSYOEDYMD%TYPE;
	v_BONUSYMD1       QPAE_MISEM.QPAE_BONUSYMD1%TYPE;
	v_BONUSYMD2       QPAE_MISEM.QPAE_BONUSYMD2%TYPE;
	v_SEISANCD        QPAE_MISEM.QPAE_SEISANCD%TYPE;
	v_MISENM          QPAE_MISEM.QPAE_MISENM%TYPE;
	v_TOZAIKBNE       QPAE_MISEM.QPAE_TOZAIKBNE%TYPE;
	v_KASIRISOKU      QPAV_KojoKoguW.QPAV_KASIRISOKU%TYPE;

BEGIN

/****************************************/
/* çTèúòAóçï\_óòëßÇvÇnÇqÇjÇsÇ…í«â¡      */
/****************************************/
	-- çTèúóòëßWORKÉfÅ[É^çÌèú
	-- ÇQèdãNìÆëŒâû
	DELETE FROM QPAW_KojoRisoW
	 WHERE QPAW_USERID     = InStrUserID
	   AND QPAW_COMPUTERNM = InStrComputerNM;

	v_ZenYMD   := TO_CHAR(ADD_MONTHS(TO_DATE(InStrYMD, 'YYYYMMDD'), -1), 'YYYYMMDD');          -- ëOåéì˙ït
	v_FROMDATE := SUBSTR(v_ZenYMD, 1, 6) || '26';                                              -- èàóùîNåéÇÃëOåé26ì˙
	v_TODATE   := SUBSTR(InStrYMD, 1, 6) || '25';                                              -- èàóùîNåéÇÃìñåé25ì˙
	v_TODATE_2 := TO_CHAR(TO_DATE(SUBSTR(InStrYMD, 1, 6) || '01', 'YYYYMMDD') -1, 'YYYYMMDD'); -- èàóùîNåéÇÃëOåéññì˙

	/*Å°è¨å˚Å°Å@è¨å˚óZéëë‰í†ÉeÅ[ÉuÉãåüçı */
	StrSQL := NULL;
	StrSQL := StrSQL || 'SELECT DISTINCT';
	StrSQL := StrSQL || ' QPA1_PRMSYAINCD1,';
	StrSQL := StrSQL || ' QPA1_PRMSYAINCD2,';
	StrSQL := StrSQL || ' QPA1_KEIYAKUYMD,';
	StrSQL := StrSQL || ' QPA1_GENDOGAKU,';
	StrSQL := StrSQL || ' QPA1_KYUYOHENSAI,';
	StrSQL := StrSQL || ' QPA1_SYOYOHENSAI,';
	StrSQL := StrSQL || ' QPA1_KYUYOZANDAKA,';
	StrSQL := StrSQL || ' QPA1_SYOYOZANDAKA,';
	StrSQL := StrSQL || ' QPAC_SIMEIKANJI,';
	StrSQL := StrSQL || ' QPAC_MISECD,';
	StrSQL := StrSQL || ' QPAC_TOZAIKBN,';
	StrSQL := StrSQL || ' QPAC_BUMONCD,';
	StrSQL := StrSQL || ' QPAC_TAISYOKUYMD,';
	StrSQL := StrSQL || ' QPAC_KYUSYOSTYMD,';
	StrSQL := StrSQL || ' QPAC_KYUSYOEDYMD,';
	StrSQL := StrSQL || ' QPAE_BONUSYMD1,';
	StrSQL := StrSQL || ' QPAE_BONUSYMD2,';
	StrSQL := StrSQL || ' QPAE_SEISANCD,';
	StrSQL := StrSQL || ' QPAE_MISENM,';
	StrSQL := StrSQL || ' QPAE_TOZAIKBNE';
	StrSQL := StrSQL || ' FROM QPA1_KGCDAICYOT,';
	StrSQL := StrSQL || '      QPAC_SYAINM,';
	StrSQL := StrSQL || '      QPAE_MISEM';
	StrSQL := StrSQL || ' WHERE (QPA1_KOJOCYUSHIFLG IS NULL OR QPA1_KOJOCYUSHIFLG = '' '')';
	StrSQL := StrSQL || '   AND QPAC_PRMSYAINCD1 = QPA1_PRMSYAINCD1 ';
	StrSQL := StrSQL || '   AND QPAC_PRMSYAINCD2 = QPA1_PRMSYAINCD2 ';
	StrSQL := StrSQL || '   AND QPAC_MISECD      = QPAE_PRMMISECD(+)';

	/* ìÆìIÉJÅ[É\ÉãÇÃÉIÅ[ÉvÉì */
	v_CursorID  := DBMS_SQL.OPEN_CURSOR;
	/* SQLÇÃâêÕ */
	DBMS_SQL.PARSE (v_CursorID, StrSQL, DBMS_SQL.v7);
	/* èoóÕïœêîÇÃÉoÉCÉìÉh */
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  1, v_PRMSYAINCD1 ,    1);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  2, v_PRMSYAINCD2 ,    7);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  3, v_KEIYAKUYMD        );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  4, v_GENDOGAKU         );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  5, v_KYUYOHENSAI       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  6, v_SYOYOHENSAI       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  7, v_KYUYOZANDAKA      );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  8, v_SYOYOZANDAKA      );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,  9, v_SIMEIKANJI   ,  20);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 10, v_MISECD       ,   3);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 11, v_TOZAIKBN     ,   1);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 12, v_BUMONCD      ,   6);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 13, v_TAISYOKUYMD       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 14, v_KYUSYOSTYMD       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 15, v_KYUSYOEDYMD       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 16, v_BONUSYMD1    ,   4);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 17, v_BONUSYMD2    ,   4);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 18, v_SEISANCD     ,   3);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 19, v_MISENM       ,  24);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 20, v_TOZAIKBNE    ,   1);

	/* SQLÇÃé¿çs */
	v_Dummy := DBMS_SQL.EXECUTE (v_CursorID);

	WHILE DBMS_SQL.FETCH_ROWS (v_CursorID) <> 0 LOOP
		/* ÉJÉâÉÄílÇïœêîÇ÷äiî[ */
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  1, v_PRMSYAINCD1  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  2, v_PRMSYAINCD2  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  3, v_KEIYAKUYMD   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  4, v_GENDOGAKU    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  5, v_KYUYOHENSAI  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  6, v_SYOYOHENSAI  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  7, v_KYUYOZANDAKA );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  8, v_SYOYOZANDAKA );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,  9, v_SIMEIKANJI   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 10, v_MISECD       );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 11, v_TOZAIKBN     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 12, v_BUMONCD      );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 13, v_TAISYOKUYMD  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 14, v_KYUSYOSTYMD  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 15, v_KYUSYOEDYMD  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 16, v_BONUSYMD1    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 17, v_BONUSYMD2    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 18, v_SEISANCD     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 19, v_MISENM       );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 20, v_TOZAIKBNE    );

		/* è‹ó^éxããîNåéì˙ÇÃçƒï“èW */
		v_BONUSYMD18 := SUBSTR(InStrYMD, 1, 4) || v_BONUSYMD1;
		v_BONUSYMD28 := SUBSTR(InStrYMD, 1, 4) || v_BONUSYMD2;
		v_BONUSYMD18 := QPAP_CEnt1401GetBONUSDayFnc(InStrYMD, v_BONUSYMD1);
		v_BONUSYMD28 := QPAP_CEnt1401GetBONUSDayFnc(InStrYMD, v_BONUSYMD2);
		IF v_BONUSYMD18 > v_BONUSYMD28 THEN
			v_BONUSYMD_W := v_BONUSYMD18;
			v_BONUSYMD18 := v_BONUSYMD28;
			v_BONUSYMD28 := v_BONUSYMD_W;
		END IF;
		v_SYOYOMM  := SUBSTR(InStrYMD,     5, 2);
		v_BONUSMM1 := SUBSTR(v_BONUSYMD18, 5, 2);
		v_BONUSMM2 := SUBSTR(v_BONUSYMD28, 5, 2);

		/* ÉèÅ[ÉNÅ@çTèúòAóçï\_óòëßÇsÇ…í«â¡ */
		IF (TO_NUMBER(v_BONUSYMD18) >= TO_NUMBER(v_FROMDATE) AND TO_NUMBER(v_BONUSYMD18) <= TO_NUMBER(v_TODATE))
		OR (TO_NUMBER(v_BONUSYMD28) >= TO_NUMBER(v_FROMDATE) AND TO_NUMBER(v_BONUSYMD28) <= TO_NUMBER(v_TODATE)) THEN

			/* è¨å˚çTèúè‹ó^ï‘çœì˙éÊìæ */
			IF v_BONUSMM1 = v_SYOYOMM OR v_BONUSMM2 = v_SYOYOMM THEN
				v_YMD := InStrYMD;
			ELSIF TO_NUMBER(v_BONUSMM1) = TO_NUMBER(v_SYOYOMM) - 1 OR TO_NUMBER(v_BONUSMM2) = TO_NUMBER(v_SYOYOMM) - 1 THEN
				v_YMD := v_ZenYMD;
			END IF;

			/* è¨å˚ï‘çœäzèÓïÒéÊìæ */
			StrSQL := NULL;
			StrSQL := StrSQL || 'SELECT';
			StrSQL := StrSQL || ' NVL(QPA2_KYUYOHENSAI,0),';
			StrSQL := StrSQL || ' NVL(QPA2_SYOYOHENSAI,0)';
			StrSQL := StrSQL || '  FROM  QPA2_KGCHENSAIT';
			StrSQL := StrSQL || ' WHERE QPA2_PRMSYAINCD1  = :Code1';
			StrSQL := StrSQL || '   AND QPA2_PRMSYAINCD2  = :Code2';
			StrSQL := StrSQL || '   AND QPA2_PRMHENKOUYM  <= :YM';
			StrSQL := StrSQL || ' ORDER BY QPA2_PRMHENKOUYM DESC';
			/* ìÆìIÉJÅ[É\ÉãÇÃÉIÅ[ÉvÉì */
			v_CursorID2  := DBMS_SQL.OPEN_CURSOR;
			/* SQLÇÃâêÕ */
			DBMS_SQL.PARSE (v_CursorID2, StrSQL, DBMS_SQL.v7);
			/* ì¸óÕïœêîÇÉoÉCÉìÉhÇ∑ÇÈ */
			DBMS_SQL.BIND_VARIABLE(v_CursorID2, ':Code1', v_PRMSYAINCD1       );
			DBMS_SQL.BIND_VARIABLE(v_CursorID2, ':Code2', v_PRMSYAINCD2       );
			DBMS_SQL.BIND_VARIABLE(v_CursorID2, ':YM',    SUBSTR(v_YMD, 1, 6) );
			/* èoóÕïœêîÇÃÉoÉCÉìÉh */
			DBMS_SQL.DEFINE_COLUMN(v_CursorID2, 1, v_KYUYOHENSAI);
			DBMS_SQL.DEFINE_COLUMN(v_CursorID2, 2, v_SYOYOHENSAI);
			/* SQLÇÃé¿çs */
			v_Dummy := DBMS_SQL.EXECUTE (v_CursorID2);
			/* FETCH */
			IF DBMS_SQL.FETCH_ROWS (v_CursorID2) <> 0 THEN
			/* ÉJÉâÉÄílÇïœêîÇ÷äiî[ */
				DBMS_SQL.COLUMN_VALUE(v_CursorID2, 1, v_KYUYOHENSAI);
				DBMS_SQL.COLUMN_VALUE(v_CursorID2, 2, v_SYOYOHENSAI);
			END IF;
			/* ÉJÅ[É\ÉãÇÃÉNÉçÅ[ÉY */
			DBMS_SQL.CLOSE_CURSOR (v_CursorID2);

			/* ìåêºãÊï™ëŒâû */
			IF  v_TOZAIKBN = '0' THEN     --ìåêºãÊï™ ïsíË
				IF v_TOZAIKBNE = '1' THEN
					v_TOZAIKBN := '1';
				ELSE
					v_TOZAIKBN := '2';
				END IF;
			END IF;

			/* çTèúÉeÅ[ÉuÉãÇÊÇËécçÇéÊìæ */
			v_SelectFlg := 1;
			BEGIN
				SELECT NVL(QPAA_ZANDAKA,0)
				  INTO v_ZANDAKA
				  FROM QPAA_KOJOT
				 WHERE QPAA_SYAINCD1 = v_PRMSYAINCD1
				   AND QPAA_SYAINCD2 = v_PRMSYAINCD2
				   AND QPAA_SYUBETU  = '1'
				   AND QPAA_YUSIKBN  = '3';
			EXCEPTION
				WHEN NO_DATA_FOUND THEN
					v_SelectFlg := 0;
				WHEN OTHERS        THEN
				RAISE;
			END;

			--çTèúÉèÅ[ÉNÉeÅ[ÉuÉãí«â¡
			INSERT INTO QPAW_KojoRisoW VALUES (
				 NVL(v_PRMSYAINCD1,' ')                                    --å¬êlÉRÅ[ÉhÇP
				,NVL(v_PRMSYAINCD2,' ')                                    --å¬êlÉRÅ[ÉhÇQ
				,'1'                                                       --ÉçÅ[ÉìéÌï 
				,v_KEIYAKUYMD                                              --å_ñÒì˙
				,NULL                                                      --óZéëì˙
				,NVL(v_GENDOGAKU,0)                                        --óZéëäzå¿ìxäz
				,0                                                         --å_ñÒóòó¶
				,0                                                         --ï‘çœåéêî
				,0                                                         --ããó^ï‘çœäzëçäz
				,NVL(v_KYUYOHENSAI, 0)                                     --ããó^ï‘çœäzããó^éû
				,0                                                         --è‹ó^ï‘çœäzëçäz
				,NVL(v_SYOYOHENSAI, 0)                                     --è‹ó^ï‘çœäzè‹ó^éû
				,NULL                                                      --äÆçœì˙
				,DECODE(v_SelectFlg, 1, v_ZANDAKA, NVL(v_KYUYOZANDAKA,0))  --ããó^écçÇ
				,NVL(v_SYOYOZANDAKA,0)                                     --è‹ó^écçÇ
				,0                                                         --óòëß
				,NVL(v_TOZAIKBN,' ')                                       --ìåêºãÊï™
				,NVL(v_SEISANCD,' ')                                       --ê∏éZìXÉRÅ[Éh
				,NVL(v_MISECD,' ')                                         --èäëÆìXÉRÅ[Éh
				,NVL(v_BUMONCD,' ')                                        --èäëÆïîñÂÉRÅ[Éh
				,NVL(v_MISENM,' ')                                         --ìXñºèÃ
				,NVL(v_SIMEIKANJI,' ')                                     --å¬êlñºäøéö
				,v_TAISYOKUYMD                                             --ëﬁêEîNåéì˙
				,v_KYUSYOSTYMD                                             --ãxêEîNåéì˙
				,TO_DATE(v_BONUSYMD18,'YYYYMMDD')                          --è‹ó^éxããåéÇP
				,TO_DATE(v_BONUSYMD28,'YYYYMMDD')                          --è‹ó^éxããåéÇQ
				,InStrUserID
				,InStrComputerNM
			);
		END IF;

	END LOOP;
	/* ÉJÅ[É\ÉãÇÃÉNÉçÅ[ÉY */
	DBMS_SQL.CLOSE_CURSOR(v_CursorID);

	/*Å°èÿèëÅ°Å@é–àıóZéëë‰í†ÉeÅ[ÉuÉãåüçı */
	StrSQL := NULL;
	StrSQL := StrSQL || 'SELECT DISTINCT';
	StrSQL := StrSQL || ' QPA8_PRMSYAINCD1,';
	StrSQL := StrSQL || ' QPA8_PRMSYAINCD2,';
	StrSQL := StrSQL || ' QPA8_PRMYUSIYMD,';
	StrSQL := StrSQL || ' QPA8_GENDOGAKU,';
	StrSQL := StrSQL || ' QPA8_RIRITU,';
	StrSQL := StrSQL || ' QPA8_HENSAITUKISU,';
	StrSQL := StrSQL || ' QPA8_KYUYOHENSAIALL,';
	StrSQL := StrSQL || ' QPA8_KYUYOHENSAI,';
	StrSQL := StrSQL || ' QPA8_SYOYOHENSAIALL,';
	StrSQL := StrSQL || ' QPA8_SYOYOHENSAI,';
	StrSQL := StrSQL || ' QPA8_KANSAIYMD,';
	StrSQL := StrSQL || ' QPA8_KYUYOZANDAKA,';
	StrSQL := StrSQL || ' QPA8_SYOYOZANDAKA,';
	StrSQL := StrSQL || ' QPAC_SIMEIKANJI,';
	StrSQL := StrSQL || ' QPAC_MISECD,';
	StrSQL := StrSQL || ' QPAC_TOZAIKBN,';
	StrSQL := StrSQL || ' QPAC_BUMONCD,';
	StrSQL := StrSQL || ' QPAC_TAISYOKUYMD,';
	StrSQL := StrSQL || ' QPAC_KYUSYOSTYMD,';
	StrSQL := StrSQL || ' QPAC_KYUSYOEDYMD,';
	StrSQL := StrSQL || ' QPAE_BONUSYMD1,';
	StrSQL := StrSQL || ' QPAE_BONUSYMD2,';
	StrSQL := StrSQL || ' QPAE_SEISANCD,';
	StrSQL := StrSQL || ' QPAE_MISENM,';
	StrSQL := StrSQL || ' QPAE_TOZAIKBNE ';
	StrSQL := StrSQL || ' FROM QPA8_SYNDAICYOT,';
	StrSQL := StrSQL || '      QPAC_SYAINM,';
	StrSQL := StrSQL || '      QPAE_MISEM';
	StrSQL := StrSQL || ' WHERE QPA8_SYOYOZANDAKA <> 0';
	/* MOD 00001 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA START */
--	StrSQL := StrSQL || '   AND QPA8_KANSAIYMD IS NULL';
	StrSQL := StrSQL || '   AND (QPA8_KANSAIYMD IS NULL';
	StrSQL := StrSQL || '   OR  QPA8_KANSAIYMD >= TO_DATE(:SyousyoYM,''YYYYMM''))';
	/* MOD 00001 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA END */
	StrSQL := StrSQL || '   AND (QPA8_KOJOCYUSIFLG IS NULL OR QPA8_KOJOCYUSIFLG = '' '')';
	StrSQL := StrSQL || '   AND QPAC_PRMSYAINCD1 = QPA8_PRMSYAINCD1 ';
	StrSQL := StrSQL || '   AND QPAC_PRMSYAINCD2 = QPA8_PRMSYAINCD2 ';
	StrSQL := StrSQL || '   AND QPAC_MISECD      = QPAE_PRMMISECD(+)';

	/* ìÆìIÉJÅ[É\ÉãÇÃÉIÅ[ÉvÉì */
	v_CursorID  := DBMS_SQL.OPEN_CURSOR;
	/* SQLÇÃâêÕ */
	DBMS_SQL.PARSE (v_CursorID,StrSQL, DBMS_SQL.v7);
	/* ì¸óÕïœêîÇÉoÉCÉìÉhÇ∑ÇÈ */
    /* ADD 0811051 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA START */
    DBMS_SQL.BIND_VARIABLE(v_CursorID,':SyousyoYM', SUBSTR(InStrYMD,1,6));
    /* ADD 0811051 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA END */

	/* èoóÕïœêîÇÃÉoÉCÉìÉh */
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 1,v_PRMSYAINCD1,  1);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 2,v_PRMSYAINCD2,  7);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 3,v_PRMYUSIYMD     );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 4,v_GENDOGAKU      );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 5,v_RIRITU         );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 6,v_HENSAITUKISU   );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 7,v_KYUYOHENSAIALL );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 8,v_KYUYOHENSAI    );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 9,v_SYOYOHENSAIALL );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,10,v_SYOYOHENSAI    );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,11,v_KANSAIYMD      );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,12,v_KYUYOZANDAKA   );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,13,v_SYOYOZANDAKA   );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,14,v_SIMEIKANJI,  20);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,15,v_MISECD,       3);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,16,v_TOZAIKBN,     1);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,17,v_BUMONCD,      6);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,18,v_TAISYOKUYMD    );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,19,v_KYUSYOSTYMD    );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,20,v_KYUSYOEDYMD    );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,21,v_BONUSYMD1,    4);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,22,v_BONUSYMD2,    4);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,23,v_SEISANCD,     3);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,24,v_MISENM,      24);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,25,v_TOZAIKBNE,    1);
	/* SQLÇÃé¿çs */
	v_Dummy := DBMS_SQL.EXECUTE (v_CursorID);

	WHILE DBMS_SQL.FETCH_ROWS (v_CursorID) <> 0 LOOP
		/* ÉJÉâÉÄílÇïœêîÇ÷äiî[ */
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 1,v_PRMSYAINCD1   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 2,v_PRMSYAINCD2   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 3,v_PRMYUSIYMD    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 4,v_GENDOGAKU     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 5,v_RIRITU        );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 6,v_HENSAITUKISU  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 7,v_KYUYOHENSAIALL);
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 8,v_KYUYOHENSAI   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 9,v_SYOYOHENSAIALL);
		DBMS_SQL.COLUMN_VALUE(v_CursorID,10,v_SYOYOHENSAI   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,11,v_KANSAIYMD     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,12,v_KYUYOZANDAKA  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,13,v_SYOYOZANDAKA  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,14,v_SIMEIKANJI    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,15,v_MISECD        );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,16,v_TOZAIKBN      );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,17,v_BUMONCD       );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,18,v_TAISYOKUYMD   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,19,v_KYUSYOSTYMD   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,20,v_KYUSYOEDYMD   );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,21,v_BONUSYMD1     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,22,v_BONUSYMD2     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,23,v_SEISANCD      );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,24,v_MISENM        );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,25,v_TOZAIKBNE     );

		/* è‹ó^éxããîNåéì˙ÇÃçƒï“èW */
		v_BONUSYMD18 := SUBSTR(InStrYMD, 1, 4) || v_BONUSYMD1;
		v_BONUSYMD28 := SUBSTR(InStrYMD, 1, 4) || v_BONUSYMD2;
		v_BONUSYMD18 := QPAP_CEnt1401GetBONUSDayFnc(InStrYMD, v_BONUSYMD1);
		v_BONUSYMD28 := QPAP_CEnt1401GetBONUSDayFnc(InStrYMD, v_BONUSYMD2);
		IF v_BONUSYMD18 > v_BONUSYMD28 THEN
			v_BONUSYMD_W := v_BONUSYMD18;
			v_BONUSYMD18 := v_BONUSYMD28;
			v_BONUSYMD28 := v_BONUSYMD_W;
		END IF;
		v_SYOYOMM  := SUBSTR(InStrYMD,     5, 2);
		v_BONUSMM1 := SUBSTR(v_BONUSYMD18, 5, 2);
		v_BONUSMM2 := SUBSTR(v_BONUSYMD28, 5, 2);

		/* ÉèÅ[ÉNÅ@çTèúòAóçï\_óòëßÇsÇ…í«â¡ */
		IF (TO_NUMBER(v_BONUSYMD18) >= TO_NUMBER(v_FROMDATE) AND TO_NUMBER(v_BONUSYMD18) <= TO_NUMBER(v_TODATE))
		OR (TO_NUMBER(v_BONUSYMD28) >= TO_NUMBER(v_FROMDATE) AND TO_NUMBER(v_BONUSYMD28) <= TO_NUMBER(v_TODATE)) THEN

			/*   óZéëì˙ <= èÿèëíäèoì˙ït  */
			IF  TO_CHAR(v_PRMYUSIYMD,'YYYYMMDD') <= IngblSyousyoYMD THEN
		
				-- óòëßéZèoèàóùÇÃè‹ó^ì˙åàíË
				IF (TO_NUMBER(v_BONUSYMD18) >= TO_NUMBER(v_FROMDATE) AND TO_NUMBER(v_BONUSYMD18) <= TO_NUMBER(v_TODATE_2))
				OR (TO_NUMBER(v_BONUSYMD28) >= TO_NUMBER(v_FROMDATE) AND TO_NUMBER(v_BONUSYMD28) <= TO_NUMBER(v_TODATE_2)) THEN
					--è‹ó^ì˙Ç™êÊåé26ì˙Å`êÊåéññì˙Ç»ÇÁëOåé
					InStrYMD_2 := v_ZenYMD;
				ELSE
					--è‹ó^ì˙Ç™èàóùîNåéì˙Ç»ÇÁèàóùîNåé
					InStrYMD_2 := InStrYMD;
				END IF;

				/* ìåêºãÊï™ëŒâû */
				IF  v_TOZAIKBN = '0' THEN     --ìåêºãÊï™ ïsíË
					IF v_TOZAIKBNE = '1' THEN
						v_TOZAIKBN := '1';
					ELSE
						v_TOZAIKBN := '2';
					END IF;
				END IF;
				/* çTèúÉeÅ[ÉuÉãÇÊÇËécçÇéÊìæ */
				v_SelectFlg := 1;
				BEGIN
					SELECT NVL(QPAA_ZANDAKA,0)
					  INTO v_ZANDAKA
					  FROM QPAA_KOJOT
					 WHERE QPAA_SYAINCD1 = v_PRMSYAINCD1
					   AND QPAA_SYAINCD2 = v_PRMSYAINCD2
					   AND QPAA_YUSIYMD  = v_PRMYUSIYMD
					   AND QPAA_SYUBETU  = '2'
					   AND QPAA_YUSIKBN  = '3';
				EXCEPTION
					WHEN NO_DATA_FOUND THEN
						v_SelectFlg := 0;
					WHEN OTHERS        THEN
						RAISE;
				END;

				/* óòëßåvéZ */
				v_Risoku := QPAP_CEnt1401SyoRisokuFnc(
							v_PRMYUSIYMD,        --óZéëì˙
							v_SYOYOHENSAIALL,    --è‹ó^ï‘çœëçäz
							v_SYOYOHENSAI,       --è‹ó^ï‘çœäz
							v_SYOYOZANDAKA,      --è‹ó^écçÇ
							v_RIRITU,            --å_ñÒóòó¶
							v_BONUSYMD18,        --è‹ó^éxããì˙ÇP
							v_BONUSYMD28,        --è‹ó^éxããì˙ÇQ
							InStrYMD_2           --è‹ó^ì˙ït
							);

				INSERT INTO QPAW_KojoRisoW VALUES (
					 NVL(v_PRMSYAINCD1,' ')   --å¬êlÉRÅ[ÉhÇP
					,NVL(v_PRMSYAINCD2,' ')   --å¬êlÉRÅ[ÉhÇQ
					,'2'                      --ÉçÅ[ÉìéÌï 
					,NULL                     --å_ñÒì˙
					,v_PRMYUSIYMD             --óZéëì˙
					,NVL(v_GENDOGAKU,0)       --óZéëäzå¿ìxäz
					,NVL(v_RIRITU,0)          --å_ñÒóòó¶
					,NVL(v_HENSAITUKISU,0)    --ï‘çœåéêî
					,NVL(v_KYUYOHENSAIALL,0)  --ããó^ï‘çœäzëçäz
					,NVL(v_KYUYOHENSAI,0)     --ããó^ï‘çœäzããó^éû
					,NVL(v_SYOYOHENSAIALL,0)  --è‹ó^ï‘çœäzëçäz
					,NVL(v_SYOYOHENSAI,0)     --è‹ó^ï‘çœäzè‹ó^éû
					,v_KANSAIYMD              --äÆçœì˙
					,DECODE(v_SelectFlg, 1, v_ZANDAKA - NVL(v_SYOYOZANDAKA, 0) , NVL(v_KYUYOZANDAKA,0) )    --ããó^écçÇ
					,NVL(v_SYOYOZANDAKA,0)    --è‹ó^écçÇ
					,v_Risoku                 --óòëß
					,NVL(v_TOZAIKBN,' ')      --ìåêºãÊï™
					,NVL(v_SEISANCD,' ')      --ê∏éZìXÉRÅ[Éh
					,NVL(v_MISECD,' ')        --èäëÆìXÉRÅ[Éh
					,NVL(v_BUMONCD,' ')       --èäëÆïîñÂÉRÅ[Éh
					,NVL(v_MISENM,' ')        --ìXñºèÃ
					,NVL(v_SIMEIKANJI,' ')    --å¬êlñºäøéö
					,v_TAISYOKUYMD            --ëﬁêEîNåéì˙
					,v_KYUSYOSTYMD            --ãxêEîNåéì˙
					,TO_DATE(v_BONUSYMD18,'YYYYMMDD')     --è‹ó^éxããåéÇP
					,TO_DATE(v_BONUSYMD28,'YYYYMMDD')     --è‹ó^éxããåéÇQ
					,InStrUserID
					,InStrComputerNM
					);
			END IF;
		END IF;
	END LOOP;
	/* ÉJÅ[É\ÉãÇÃÉNÉçÅ[ÉY */
	DBMS_SQL.CLOSE_CURSOR(v_CursorID);
	/* ÉRÉ~ÉbÉg */
	COMMIT;

EXCEPTION
	WHEN  OTHERS  THEN
		IF DBMS_SQL.IS_OPEN (v_CursorID) THEN
			DBMS_SQL.CLOSE_CURSOR(v_CursorID);
		END IF;
		/* ÉçÅ[ÉãÉoÉbÉN */
		ROLLBACK;
	RAISE ;
END QPAP_CEnt1401SyouyoRisoku;

/*****************************************************************************/
/* ÉÇÉWÉÖÅ[Éãñº  ÅFQPAP_CEnt1401KojoPrtSyouyo2                               */
/* ã@î\          ÅFçTèúòAóçï\_è‹ó^àÛç¸ÇvÇnÇqÇjçÏê¨ [ìoò^Ç∑ÇÈÉeÅ[ÉuÉãïœçXî≈]  */
/* çÏê¨          ÅF2003.03.25                                                */
/*****************************************************************************/
PROCEDURE QPAP_CEnt1401KojoPrtSyouyo2 (
	InStrUserID     IN  VARCHAR2,                         --ÉÜÅ[ÉUÅ[ÇhÇc
	InStrComputerNM IN  VARCHAR2,                         --ÉRÉìÉsÉÖÅ[É^ñº
	InStrYMD        IN  VARCHAR2) IS                      --ããó^ì˙ït

	/* èàóùå≈óLÇÃïœêî */
	v_CursorID        NUMBER := 0;
	v_KINGAKU         NUMBER(7,0);  --ã‡äz
	v_GANKIN          NUMBER(7,0);  --å≥ã‡
	v_ZANDAKA         NUMBER(7,0);  --écçÇ
	v_Dummy           INTEGER;
	v_OutPutFLG       INTEGER;      --èoóÕÉtÉâÉO
	
	/* ÉoÉCÉìÉhïœêî */
	v_BUMONNM         QPAF_BUMONM.QPAF_BUMONNM%TYPE;
	v_SEISANNM        QPAG_SEISANM.QPAG_SEISANNM%TYPE;
	v_SYAINCD1        QPAW_KojoRisoW.QPAW_SYAINCD1%TYPE;
	v_SYAINCD2        QPAW_KojoRisoW.QPAW_SYAINCD2%TYPE;
	v_SYUBETU         QPAW_KojoRisoW.QPAW_SYUBETU%TYPE;
	v_KEIYAKUYMD      QPAW_KojoRisoW.QPAW_KEIYAKUYMD%TYPE;
	v_YUSIYMD         QPAW_KojoRisoW.QPAW_YUSIYMD%TYPE;
	v_GENDOGAKU       QPAW_KojoRisoW.QPAW_GENDOGAKU%TYPE;
	v_RIRITU          QPAW_KojoRisoW.QPAW_RIRITU%TYPE;
	v_HENSAITUKISU    QPAW_KojoRisoW.QPAW_HENSAITUKISU%TYPE;
	v_KYUYOHENSAIALL  QPAW_KojoRisoW.QPAW_KYUYOHENSAIALL%TYPE;
	v_KYUYOHENSAI     QPAW_KojoRisoW.QPAW_KYUYOHENSAI%TYPE;
	v_SYOYOHENSAIALL  QPAW_KojoRisoW.QPAW_SYOYOHENSAIALL%TYPE;
	v_SYOYOHENSAI     QPAW_KojoRisoW.QPAW_SYOYOHENSAI%TYPE;
	v_KANSAIYMD       QPAW_KojoRisoW.QPAW_KANSAIYMD%TYPE;
	v_KYUYOZANDAKA    QPAW_KojoRisoW.QPAW_KYUYOZANDAKA%TYPE;
	v_SYOYOZANDAKA    QPAW_KojoRisoW.QPAW_SYOYOZANDAKA%TYPE;
	v_RISOKU          QPAW_KojoRisoW.QPAW_RISOKU%TYPE;
	v_TOZAIKBN        QPAW_KojoRisoW.QPAW_TOZAIKBN%TYPE;
	v_SEISANCD        QPAW_KojoRisoW.QPAW_SEISANCD%TYPE;
	v_MISECD          QPAW_KojoRisoW.QPAW_MISECD%TYPE;
	v_BUMONCD         QPAW_KojoRisoW.QPAW_BUMONCD%TYPE;
	v_MISENM          QPAW_KojoRisoW.QPAW_MISENM%TYPE;
	v_SIMEIKANJI      QPAW_KojoRisoW.QPAW_SIMEIKANJI%TYPE;
	v_TAISYOKUYMD     QPAW_KojoRisoW.QPAW_TAISYOKUYMD%TYPE;
	v_KYUSYOKUYMD     QPAW_KojoRisoW.QPAW_KYUSYOKUYMD%TYPE;
	v_BONUSYMD1       QPAW_KojoRisoW.QPAW_BONUSYMD1%TYPE;
	v_BONUSYMD2       QPAW_KojoRisoW.QPAW_BONUSYMD2%TYPE;
	v_MEI             QSA2_SCODET.QSA2_MEI%TYPE;

	v_SYORIYMD        CHAR(8);
	v_SYORIMM         CHAR(2);

BEGIN

	/****************************************/
	/* çTèúòAóçï\_àÛç¸ÇvÇnÇqÇjÇsÇ…í«â¡  Å@Å@*/
	/****************************************/
	DELETE FROM QPAM_SYNKEISANW
	 WHERE QPAM_USERID     = InStrUserID
	   AND QPAM_COMPUTERNM = InStrComputerNM;

	v_FROMDATE := TO_CHAR(ADD_MONTHS(TO_DATE(InStrYMD, 'YYYYMMDD'), -1), 'YYYYMM') || '26';  -- èàóùîNåéÇÃëOåé26ì˙
	v_TODATE   := SUBSTR(InStrYMD, 1, 6) || '25';                                            -- èàóùîNåéÇÃìñåé25ì˙

	/*ÉèÅ[ÉNÅ@çTèúòAóçï\_óòëßÇsåüçı */
	StrSQL := NULL;
	StrSQL := StrSQL || 'SELECT DISTINCT';
	StrSQL := StrSQL || ' QPAW_SYAINCD1,';
	StrSQL := StrSQL || ' QPAW_SYAINCD2,';
	StrSQL := StrSQL || ' QPAW_SYUBETU,';
	StrSQL := StrSQL || ' QPAW_KEIYAKUYMD,';
	StrSQL := StrSQL || ' QPAW_YUSIYMD,';
	StrSQL := StrSQL || ' QPAW_GENDOGAKU,';
	StrSQL := StrSQL || ' QPAW_RIRITU,';
	StrSQL := StrSQL || ' QPAW_HENSAITUKISU,';
	StrSQL := StrSQL || ' QPAW_KYUYOHENSAIALL,';
	StrSQL := StrSQL || ' QPAW_KYUYOHENSAI,';
	StrSQL := StrSQL || ' QPAW_SYOYOHENSAIALL,';
	StrSQL := StrSQL || ' QPAW_SYOYOHENSAI,';
	StrSQL := StrSQL || ' QPAW_KANSAIYMD,';
	StrSQL := StrSQL || ' QPAW_KYUYOZANDAKA,';
	StrSQL := StrSQL || ' QPAW_SYOYOZANDAKA,';
	StrSQL := StrSQL || ' QPAW_RISOKU,';
	StrSQL := StrSQL || ' QPAW_TOZAIKBN,';
	StrSQL := StrSQL || ' QPAW_SEISANCD,';
	StrSQL := StrSQL || ' QPAW_MISECD,';
	StrSQL := StrSQL || ' QPAW_BUMONCD,';
	StrSQL := StrSQL || ' QPAW_MISENM,';
	StrSQL := StrSQL || ' QPAW_SIMEIKANJI,';
	StrSQL := StrSQL || ' QPAW_TAISYOKUYMD,';
	StrSQL := StrSQL || ' QPAW_KYUSYOKUYMD,';
	StrSQL := StrSQL || ' QPAW_BONUSYMD1,';
	StrSQL := StrSQL || ' QPAW_BONUSYMD2,';
	StrSQL := StrSQL || ' QPAF_BUMONNM,';
	StrSQL := StrSQL || ' QPAG_SEISANNM ';
	StrSQL := StrSQL || ' FROM QPAW_KojoRisoW';
	StrSQL := StrSQL || '     ,QPAF_BUMONM';
	StrSQL := StrSQL || '     ,QPAG_SEISANM ';
	StrSQL := StrSQL || ' WHERE QPAW_MISECD   = QPAF_PRMMISECD(+)';
	StrSQL := StrSQL || '   AND QPAW_BUMONCD  = QPAF_PRMBUMONCD(+)';
	StrSQL := StrSQL || '   AND QPAW_SEISANCD = QPAG_PRMSEISANCD(+)';
	StrSQL := StrSQL || '   AND (QPAW_TAISYOKUYMD IS NULL';
	StrSQL := StrSQL || '        OR TO_CHAR(QPAW_TAISYOKUYMD,''YYYYMMDD'') > :StrYMD)';
	StrSQL := StrSQL || '   AND (QPAW_KYUSYOKUYMD IS NULL';
	StrSQL := StrSQL || '        OR TO_CHAR(QPAW_KYUSYOKUYMD,''YYYYMMDD'') > :StrYMD)';
	StrSQL := StrSQL || '   AND QPAW_USERID     = :StrUserID';
	StrSQL := StrSQL || '   AND QPAW_COMPUTERNM = :StrComputerNM';

	/* ìÆìIÉJÅ[É\ÉãÇÃÉIÅ[ÉvÉì */
	v_CursorID  := DBMS_SQL.OPEN_CURSOR;
	/* SQLÇÃâêÕ */
	DBMS_SQL.PARSE (v_CursorID, StrSQL, DBMS_SQL.v7);
	/* ì¸óÕïœêîÇÉoÉCÉìÉhÇ∑ÇÈ */
	DBMS_SQL.BIND_VARIABLE(v_CursorID,':StrYMD',        InStrYMD);
	DBMS_SQL.BIND_VARIABLE(v_CursorID,':StrUserID',     InStrUserID);
	DBMS_SQL.BIND_VARIABLE(v_CursorID,':StrComputerNM' ,InStrComputerNM);
	/* èoóÕïœêîÇÃÉoÉCÉìÉh */
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 1,v_SYAINCD1      ,  1);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 2,v_SYAINCD2      ,  7);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 3,v_SYUBETU       ,  1);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 4,v_KEIYAKUYMD        );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 5,v_YUSIYMD           );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 6,v_GENDOGAKU         );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 7,v_RIRITU            );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 8,v_HENSAITUKISU      );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID, 9,v_KYUYOHENSAIALL    );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,10,v_KYUYOHENSAI       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,11,v_SYOYOHENSAIALL    );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,12,v_SYOYOHENSAI       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,13,v_KANSAIYMD         );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,14,v_KYUYOZANDAKA      );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,15,v_SYOYOZANDAKA      );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,16,v_RISOKU            );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,17,v_TOZAIKBN      ,  1);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,18,v_SEISANCD      ,  3);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,19,v_MISECD        ,  3);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,20,v_BUMONCD       ,  6);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,21,v_MISENM        , 24);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,22,v_SIMEIKANJI    , 40);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,23,v_TAISYOKUYMD       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,24,v_KYUSYOKUYMD       );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,25,v_BONUSYMD1         );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,26,v_BONUSYMD2         );
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,27,v_BUMONNM       , 24);
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,28,v_SEISANNM      , 24);
	/* SQLÇÃé¿çs */
	v_Dummy := DBMS_SQL.EXECUTE (v_CursorID);

	WHILE DBMS_SQL.FETCH_ROWS (v_CursorID) <> 0 LOOP
		/* èoóÕîªíËÇeÇkÇf èâä˙âª*/
		v_OutPutFLG := 0;     --Off(èoóÕÇµÇ»Ç¢)

		/* ÉJÉâÉÄílÇïœêîÇ÷äiî[ */
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 1,v_SYAINCD1        );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 2,v_SYAINCD2        );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 3,v_SYUBETU         );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 4,v_KEIYAKUYMD      );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 5,v_YUSIYMD         );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 6,v_GENDOGAKU       );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 7,v_RIRITU          );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 8,v_HENSAITUKISU    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID, 9,v_KYUYOHENSAIALL  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,10,v_KYUYOHENSAI     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,11,v_SYOYOHENSAIALL  );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,12,v_SYOYOHENSAI     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,13,v_KANSAIYMD       );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,14,v_KYUYOZANDAKA    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,15,v_SYOYOZANDAKA    );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,16,v_RISOKU          );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,17,v_TOZAIKBN        );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,18,v_SEISANCD        );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,19,v_MISECD          );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,20,v_BUMONCD         );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,21,v_MISENM          );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,22,v_SIMEIKANJI      );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,23,v_TAISYOKUYMD     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,24,v_KYUSYOKUYMD     );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,25,v_BONUSYMD1       );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,26,v_BONUSYMD2       );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,27,v_BUMONNM         );
		DBMS_SQL.COLUMN_VALUE(v_CursorID,28,v_SEISANNM        );

		/* ã‡äzéZèo */
		--ÉçÅ[ÉìéÌï ÅÅÇP
		IF v_SYUBETU = '1' THEN
			IF  v_SYOYOHENSAI <= v_KYUYOZANDAKA  THEN
				v_KINGAKU := v_SYOYOHENSAI;
			ELSE
				v_KINGAKU := v_KYUYOZANDAKA;
			END IF;
		--ÉçÅ[ÉìéÌï ÅÅÇQ
		ELSE
			IF  v_SYOYOHENSAI <= v_SYOYOZANDAKA  THEN
				v_KINGAKU := v_SYOYOHENSAI;
			ELSE
				v_KINGAKU := v_SYOYOZANDAKA + v_RISOKU;
			END IF;
		END IF;

		/* å≥ã‡éZèo */
		v_GANKIN  := v_KINGAKU - v_RISOKU;

		/* écçÇéZèo */
		--ÉçÅ[ÉìéÌï ÅÅÇP
		IF  v_SYUBETU = '1' THEN
			v_ZANDAKA := v_KYUYOZANDAKA - v_GANKIN;
		--ÉçÅ[ÉìéÌï ÅÅÇQ
		ELSE
			v_ZANDAKA := v_SYOYOZANDAKA + v_KYUYOZANDAKA - v_GANKIN;
		END IF;

		/* èàóùì˙ éZèo */
		IF    TO_NUMBER(TO_CHAR(v_BONUSYMD1, 'YYYYMMDD') ) >= TO_NUMBER(v_FROMDATE)
		AND   TO_NUMBER(TO_CHAR(v_BONUSYMD1, 'YYYYMMDD') ) <= TO_NUMBER(v_TODATE)   THEN
			v_SYORIYMD := TO_CHAR(v_BONUSYMD1, 'YYYYMMDD');

		ELSIF TO_NUMBER(TO_CHAR(v_BONUSYMD2, 'YYYYMMDD') ) >= TO_NUMBER(v_FROMDATE)
		AND   TO_NUMBER(TO_CHAR(v_BONUSYMD2, 'YYYYMMDD') ) <= TO_NUMBER(v_TODATE)   THEN
			v_SYORIYMD := TO_CHAR(v_BONUSYMD2, 'YYYYMMDD');

		END IF;

		/* îªíËóp åé */
		v_SYORIMM   := SUBSTR(InStrYMD,5,2);
		v_BONUSMM1  := SUBSTR(TO_CHAR(v_BONUSYMD1,'YYYYMMDD'), 5, 2);
		v_BONUSMM2  := SUBSTR(TO_CHAR(v_BONUSYMD2,'YYYYMMDD'), 5, 2);

		/* èoóÕîªíË */
		-- ã‡äzÅEóòëßÇ…écçÇÇ†ÇË
		IF  v_KINGAKU > 0 AND v_RISOKU > 0 THEN
			IF v_BONUSMM1 = v_SYORIMM OR v_BONUSMM2 = v_SYORIMM THEN
				v_OutPutFLG := 1;     --On(èoóÕÇ∑ÇÈ)
			END IF;
		END IF;

		--é¿çsì˙Ç™ÅAìñåéè‹ó^ä˙ä‘ì‡Ç≈Ç†ÇÈÅiëOåé26ì˙Å`ìñåé25ì˙Åj
		IF  TO_NUMBER(v_SYORIYMD) >= TO_NUMBER(v_FROMDATE) AND TO_NUMBER(v_SYORIYMD) <= TO_NUMBER(v_TODATE) THEN
			IF    v_SYUBETU = '1'   THEN	--è¨å˚ï™
				--ããó^ÅEã‡äzÇ…écçÇÇ™Ç†ÇÈ
				IF v_KINGAKU > 0 AND v_KYUYOZANDAKA > 0 THEN
					--é¿çsì˙Ç™è‹ó^åéÇ≈Ç†ÇÍÇŒèoóÕëŒè€
					v_OutPutFLG := 1;     --On(èoóÕÇ∑ÇÈ)
				END IF;

			ELSIF v_SYUBETU = '2'   THEN	--èÿèëï™
				--è‹ó^écçÇÅEã‡äzÇ…écçÇÇ™Ç†ÇÈ
				IF v_KINGAKU > 0 AND v_SYOYOZANDAKA > 0 THEN
					v_OutPutFLG := 1;     --On(èoóÕÇ∑ÇÈ)
				END IF;
			END IF;

		END IF;

		/* çTèúòAóçï\_àÛç¸ÇvÇnÇqÇjÇ…í«â¡ */
		IF  v_OutPutFLG = 1   THEN    --On(èoóÕÇ∑ÇÈ)
			/* 2001/10/12 ìåêºãÊï™ñºèÃ í«â¡ */
			IF  v_TOZAIKBN = '1' THEN
				v_SEISANNM := RTRIM(v_SEISANNM) || ' (ìå)';
			ELSE
				v_SEISANNM := RTRIM(v_SEISANNM) || ' (êº)';
			END IF;

			/* èWåvíPà ÅEèoóÕèá */
			SELECT QSA2_MEI
			  INTO v_MEI
			  FROM QSA2_SCODET
			 WHERE QSA2_PRMCODEKBN       = 'DP' || v_TOZAIKBN     --ìå
			   AND RTRIM(QSA2_PRMCODENO) = v_MISECD;

			/*ë„ë÷ÉeÅ[ÉuÉã*/
			INSERT INTO QPAM_SYNKEISANW VALUES (
				 NVL(v_SYAINCD1,' ')            --é–àıÉRÅ[ÉhÇP
				,NVL(v_SYAINCD2,' ')            --é–àıÉRÅ[ÉhÇQ
				,NVL(v_BUMONNM,' ')             --ïîñÂñº
				,NVL(v_MISENM,' ')              --ìXñº
				,SUBSTR(v_MEI,4,3)              --ìXÉRÅ[Éh
				,v_KINGAKU                      --ã‡äz
				,v_GANKIN                       --å≥ã‡
				,NVL(v_RISOKU,0)                --óòëß
				,v_ZANDAKA                      --écçÇ
				,NVL(v_BUMONCD,' ')             --ïîñÂÉRÅ[Éh
				,SUBSTR(v_MEI,1,3)              --ê∏éZìXÉRÅ[Éh
				,v_SYORIYMD                     --èàóùì˙
				,NULL
				,TO_NUMBER(NVL(v_SEISANCD,'0')) --ê∏éZìXÉRÅ[Éh
				,NULL
				,NVL(v_TOZAIKBN,' ')            --ìåêºãÊï™    
				,NULL
				,NULL
				,'0'                            --çTèúãÊï™
				,NVL(v_SYUBETU,' ')             --ÉçÅ[ÉìéÌï 
				,NULL                           --çs
				,NULL
				,NULL
				,NVL(v_SIMEIKANJI,' ')          --éÅñº
				,NVL(v_SEISANNM,' ')            --ê∏éZìXñº
				,TO_CHAR(v_YUSIYMD,'YYYYMMDD')  --óZéëì˙
				,InStrUserID                    --ÉÜÅ[ÉUÅ[ÇhÇc
				,InStrComputerNM                --ÇoÇbñº
			);

		END IF;
	END LOOP;

	/* ÉJÅ[É\ÉãÇÃÉNÉçÅ[ÉY */
	DBMS_SQL.CLOSE_CURSOR(v_CursorID);

	/* ÉRÉ~ÉbÉg */
	COMMIT;

EXCEPTION
	WHEN  OTHERS  THEN
		IF DBMS_SQL.IS_OPEN (v_CursorID) THEN
			DBMS_SQL.CLOSE_CURSOR(v_CursorID);
		END IF;
	/* ÉçÅ[ÉãÉoÉbÉN */
	ROLLBACK;
	RAISE ;
END QPAP_CEnt1401KojoPrtSyouyo2;


/* ADD 00002 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA START */
/*****************************************************************************/
/* ÉÇÉWÉÖÅ[Éãñº  ÅFQPAP_CEnt1401KojocyushiChek                               */
/* ã@î\          ÅFçTèúíÜé~îªíËèàóù                                          */
/*                 çTèúíÜé~ÉeÅ[ÉuÉãÇéQè∆ÇµÇƒÅAçTèúÉfÅ[É^çÏê¨éûÇ…ÅA          */
/*                 çTèúíÜé~ÉtÉâÉOÇÃóLñ≥ÇîªíËÇ∑ÇÈÅB                          */
/* çÏê¨          ÅF2009.08.28                                                */
/* ñﬂÇËíl        ÅFÅu1 : çTèúíÜé~íÜÅvÅu2 : çTèúíÜé~âèúíÜÅv                  */
/*****************************************************************************/
FUNCTION QPAP_CEnt1401KojocyushiChek (
	InSyainCD1          IN  VARCHAR2,                               --é–àıÉRÅ[ÉhÇP
	InSyainCD2          IN  VARCHAR2,                               --é–àıÉRÅ[ÉhÇQ
	InStrYMDHMS         IN  VARCHAR2                                --çTèúíÜé~ìoò^ì˙éû
) RETURN CHAR IS
	rKojocyushiFLG         CHAR(1);

  /* èàóùå≈óLÇÃïœêî */
	StrSQL              VARCHAR2(1000);
	v_CursorID          NUMBER := 0;
	v_Status            CHAR(1);
	v_Dummy             INTEGER;


BEGIN

	rKojocyushiFLG  := '2';

	/* çTèúíÜé~ÉeÅ[ÉuÉãÇ©ÇÁç≈êVì˙ïtÇÃíÜé~ìoò^ÉXÉeÅ[É^ÉXéÊìæ */
	StrSQL := NULL;
	StrSQL := StrSQL || ' SELECT QPB1_KOJOSTATUS' ;
	StrSQL := StrSQL || ' FROM   QPB1_KOJOCANCELT';
	StrSQL := StrSQL || ' WHERE  QPB1_PRMSYAINCD1  =  :Code1';
	StrSQL := StrSQL || ' AND    QPB1_PRMSYAINCD2  =  :Code2';
	StrSQL := StrSQL || ' AND    QPB1_CANCELDATE   <=  TO_DATE(:YMDHMS,''YYYYMMDDHH24MISS'')';
	StrSQL := StrSQL || ' ORDER BY QPB1_CANCELDATE DESC';

	/* ìÆìIÉJÅ[É\ÉãÇÃÉIÅ[ÉvÉì */
	v_CursorID  := DBMS_SQL.OPEN_CURSOR;
	/* SQLÇÃâêÕ */
	DBMS_SQL.PARSE (v_CursorID,StrSQL, DBMS_SQL.v7);
	/* ì¸óÕïœêîÇÉoÉCÉìÉhÇ∑ÇÈ */
	DBMS_SQL.BIND_VARIABLE(v_CursorID,':Code1',InSyainCD1);
	DBMS_SQL.BIND_VARIABLE(v_CursorID,':Code2',InSyainCD2);
	DBMS_SQL.BIND_VARIABLE(v_CursorID,':YMDHMS',InStrYMDHMS);
	/* èoóÕïœêîÇÃÉoÉCÉìÉh */
	DBMS_SQL.DEFINE_COLUMN(v_CursorID,1,v_Status,1);
	/* SQLÇÃé¿çs */
	v_Dummy := DBMS_SQL.EXECUTE (v_CursorID);
	/* FETCH */
	IF DBMS_SQL.FETCH_ROWS (v_CursorID) <> 0 THEN
	/* ÉJÉâÉÄílÇïœêîÇ÷äiî[ */
	DBMS_SQL.COLUMN_VALUE(v_CursorID,1,v_Status);
	END IF;
	/* ÉJÅ[É\ÉãÇÃÉNÉçÅ[ÉY */
	DBMS_SQL.CLOSE_CURSOR (v_CursorID);

	IF v_Status = '1' THEN
		rKojocyushiFLG := '1';
	ELSIF v_Status IS NULL OR v_Status = '2'  THEN
		rKojocyushiFLG := '2';
	END IF;
	
	/* ï‘ãpílÇ…ìñÇƒÇÕÇﬂÇÈ */
	RETURN rKojocyushiFLG;

EXCEPTION
  WHEN  OTHERS  THEN
    IF DBMS_SQL.IS_OPEN (v_CursorID) THEN
      DBMS_SQL.CLOSE_CURSOR (v_CursorID);
    END IF;
    RAISE ;
END QPAP_CEnt1401KojocyushiChek;
/* ADD 00002 é–àıèÿèëë›ïtí†ï[å©íºÇµ NBC ISHIDA END */

END QPAP_CEnt1401PkG;
/
SHOW ERRORS;
